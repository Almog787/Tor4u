name: Auto Update README with Riva Yehezkel QR

on:
  push:
    branches:
      - main
    paths:
      - 'config.txt'
      - 'index.html'
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Extract URL and Update README
        run: |
          # 1. Fetch the target URL from config.txt
          if [ -f config.txt ]; then
            TARGET_URL=$(cat config.txt | xargs)
          else
            TARGET_URL="https://www.riba.co.il/career/"
          fi
          
          # 2. Set the Live Site URL (GitHub Pages)
          LIVE_SITE_URL="https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/"
          
          # 3. Logo URL (Raw path)
          LOGO_URL="https://github.com/Almog787/Tor4u/blob/23806039964ab720efdbf137719691ed3c08e113/logoo-100.png?raw=true"
          
          # 4. Last update timestamp (Israel Time)
          LAST_UPDATE=$(date -u -d "+2 hours" +'%d/%m/%Y %H:%M')

          # 5. Generate Professional README.md content
          echo '<p align="center">' > README.md
          echo "  <img src=\"$LOGO_URL\" width=\"250\" alt=\"×¨×™×‘×” ×™×—×–×§××œ ×‘×§×¨×•×ª\">" >> README.md
          echo "</p>" >> README.md
          
          echo "# ðŸ“‹ ×ž×¢×¨×›×ª × ×™×”×•×œ QR ×“×™× ×ž×™ - ×ž×—×œ×§×ª ×’×™×•×¡" >> README.md
          echo "" >> README.md
          echo "×‘×¨×•×›×™× ×”×‘××™× ×œ×ž×¢×¨×›×ª × ×™×”×•×œ ×”×§×™×©×•×¨×™×•×ª ×©×œ **×¨×™×‘×” ×™×—×–×§××œ ×‘×§×¨×•×ª**. ×ž××’×¨ ×–×” ×ž××¤×©×¨ ×©×œ×™×˜×” ×ž×œ××” ×•×“×™× ×ž×™×ª ×¢×œ ×™×¢×“ ×”×¡×¨×™×§×” ×©×œ ×§×•×“ ×”-QR ×”×ž×¤×•×¨×¡× ×‘×ž×•×“×¢×•×ª ×”×“×¨×•×©×™×." >> README.md
          echo "" >> README.md
          
          echo "---" >> README.md
          echo "" >> README.md
          echo "## ðŸ¤³ ×§×•×“ ×”-QR ×œ×”×“×¤×¡×” ×•×¡×¨×™×§×”" >> README.md
          echo "×–×”×• ×”×§×•×“ ×”×§×‘×•×¢ ×©×™×© ×œ×”×¤×™×¥. ×‘×ž×™×“×” ×•×™×¢×“ ×”×ž×©×¨×•×ª ×ž×©×ª× ×”, ×”×§×•×“ ×™×™×©××¨ ×–×”×” - ×™×© ×œ×¢×“×›×Ÿ ×¨×§ ××ª ×”×§×™×©×•×¨ ×‘×ž×¢×¨×›×ª." >> README.md
          echo '<p align="center">' >> README.md
          echo '  <img src="./job_qr_code.png" width="280" style="border: 10px solid white; border-radius: 10px;" alt="QR Code">' >> README.md
          echo '</p>' >> README.md
          echo "" >> README.md
          
          echo "---" >> README.md
          echo "" >> README.md
          echo "## ðŸ“Š × ×ª×•× ×™ ×ž×¢×¨×›×ª ×¢×“×›× ×™×™×" >> README.md
          echo "| × ×ª×•×Ÿ | ×¡×˜×˜×•×¡ / ×¢×¨×š |" >> README.md
          echo "| :--- | :--- |" >> README.md
          echo "| **×ž×¦×‘ ×—×™×‘×•×¨** | ×¤×¢×™×œ ×•×ª×§×™×Ÿ âœ… |" >> README.md
          echo "| **×›×ª×•×‘×ª ×”×¤× ×™×” × ×•×›×—×™×ª** | [$TARGET_URL]($TARGET_URL) |" >> README.md
          echo "| **×“×£ × ×—×™×ª×” ×¤×¢×™×œ (Live)** | [$LIVE_SITE_URL]($LIVE_SITE_URL) |" >> README.md
          echo "| **×¢×“×›×•×Ÿ ××—×¨×•×Ÿ** | $LAST_UPDATE |" >> README.md
          echo "| **× ×™×˜×•×¨ ×•×ž×¢×§×‘** | Google Analytics 4 ×¤×¢×™×œ ðŸ“ˆ |" >> README.md
          echo "" >> README.md
          
          echo "---" >> README.md
          echo "" >> README.md
          echo "## ðŸ›  ×”×•×¨××•×ª ×ª×¤×¢×•×œ ×œ×œ×§×•×—" >> README.md
          echo "×›×“×™ ×œ×©× ×•×ª ××ª ×”×›×ª×•×‘×ª ××œ×™×” ×ž×’×™×¢ ×ž×™ ×©×¡×•×¨×§ ××ª ×”×§×•×“, ×™×© ×œ×‘×¦×¢ ××ª ×”×¤×¢×•×œ×•×ª ×”×‘××•×ª:" >> README.md
          echo "1. ×”×™×›× ×¡×• ×œ×§×•×‘×¥ [config.txt](./config.txt) ×‘×ž××’×¨ ×–×”." >> README.md
          echo "2. ×œ×—×¦×• ×¢×œ ××™×™×§×•×Ÿ ×”×¢×™×¤×¨×•×Ÿ (**Edit**) ×‘×¦×“ ×™×ž×™×Ÿ." >> README.md
          echo "3. ×”×—×œ×™×¤×• ××ª ×”×›×ª×•×‘×ª ×”×§×™×™×ž×ª ×‘×›×ª×•×‘×ª ×”×—×“×©×” (×•×•×“××• ×©×”×™× ×ž×ª×—×™×œ×” ×‘-http)." >> README.md
          echo "4. ×œ×—×¦×• ×¢×œ **Commit changes** ×‘×ª×—×ª×™×ª ×”×“×£." >> README.md
          echo "> **×”×¢×¨×”:** ×”×ž×¢×¨×›×ª ×ª×ª×¢×“×›×Ÿ ×‘××•×¤×Ÿ ××•×˜×•×ž×˜×™ ×ª×•×š ×ž×¡×¤×¨ ×©× ×™×•×ª ×ž×¨×’×¢ ×”×©×ž×™×¨×”." >> README.md
          echo "" >> README.md
          echo "---" >> README.md
          echo '<p align="right">×¤×•×ª×— ×¢×œ ×™×“×™ ×¦×•×•×ª ×¤×™×ª×•×— - GitHub Senior Partner Partner Partner Partner Partner Partner Partner</p>' >> README.md

      - name: Commit and Push changes
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add README.md
          git commit -m "Admin: Professional README update for client delivery" || echo "No changes to commit"
          git push
