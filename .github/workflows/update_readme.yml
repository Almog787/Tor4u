name: Auto Update README with Riva Yehezkel QR

on:
  push:
    branches:
      - main
    paths:
      - 'config.txt'
      - 'index.html'
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Extract URL and Update README
        run: |
          # 1. Fetch the target URL from config.txt (Fail-safe: defaults to direct link if file missing)
          if [ -f config.txt ]; then
            TARGET_URL=$(cat config.txt | xargs)
          else
            TARGET_URL="https://www.riba.co.il/career/"
          fi
          
          # 2. Set the Live Site URL (GitHub Pages)
          # Replace 'YOUR_USERNAME' and 'YOUR_REPO' with your actual details
          LIVE_SITE_URL="https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/"
          
          # 3. Last update timestamp (Approx. Israel Time)
          LAST_UPDATE=$(date -u -d "+2 hours" +'%d/%m/%Y %H:%M')

          # 4. Generate README.md content
          echo "# ðŸ“² ×ž×¢×¨×›×ª QR ×“×™× ×ž×™×ª - ×¨×™×‘×” ×™×—×–×§××œ ×‘×§×¨×•×ª" > README.md
          echo "" >> README.md
          echo "×ž×¢×¨×›×ª ×œ× ×™×”×•×œ ×”×¤× ×™×” ×“×™× ×ž×™×ª ×¢×‘×•×¨ ×ž×©×¨×•×ª ×“×¨×•×©×™×. ×›×œ ×©×™× ×•×™ ×‘×§×•×‘×¥ \`config.txt\` ×ž×¢×“×›×Ÿ ××•×˜×•×ž×˜×™×ª ××ª ×™×¢×“ ×”-QR." >> README.md
          echo "" >> README.md
          echo "## ðŸ¤³ ×§×•×“ ×”-QR ×œ×¡×¨×™×§×”" >> README.md
          echo '<p align="center">' >> README.md
          echo '  <img src="./job_qr_code.png" width="300" alt="Recruitment QR Code">' >> README.md
          echo '</p>' >> README.md
          echo "" >> README.md
          echo "---" >> README.md
          echo "" >> README.md
          echo "## ðŸ“Š ×¡×˜×˜×•×¡ ×•×ž×™×“×¢ ×˜×›× ×™" >> README.md
          echo "| × ×ª×•×Ÿ | ×¤×¨×˜×™× |" >> README.md
          echo "| :--- | :--- |" >> README.md
          echo "| **×¡×˜×˜×•×¡ ×”×¤× ×™×”** | ×¤×¢×™×œ âœ… |" >> README.md
          echo "| **×™×¢×“ ×”×¤× ×™×” × ×•×›×—×™** | [$TARGET_URL]($TARGET_URL) |" >> README.md
          echo "| **×›×ª×•×‘×ª ×”×“×£ (Live)** | [$LIVE_SITE_URL]($LIVE_SITE_URL) |" >> README.md
          echo "| **×¢×“×›×•×Ÿ ××—×¨×•×Ÿ** | $LAST_UPDATE |" >> README.md
          echo "" >> README.md
          echo "---" >> README.md
          echo "### ðŸ’¡ ×”× ×—×™×•×ª ×œ×ž× ×”×œ ×”×ž×¢×¨×›×ª" >> README.md
          echo "×›×“×™ ×œ×©× ×•×ª ××ª ×”×™×¢×“ ××œ×™×• ×”-QR ×©×•×œ×— ××ª ×”×ž×•×¢×ž×“×™×, ×™×© ×œ×¢×¨×•×š ××ª ×”×§×•×‘×¥ [config.txt](./config.txt) ×‘×ž××’×¨ ×–×”." >> README.md

      - name: Commit and Push changes
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add README.md
          git commit -m "Bot: Updated README with new redirect target and timestamp" || echo "No changes to commit"
          git push
